<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="heemod">
<title>Probabilistic Uncertainty Analysis • heemod</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probabilistic Uncertainty Analysis">
<meta property="og:description" content="heemod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">heemod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_introduction.html">An Introduction to `heemod`</a>
    <a class="dropdown-item" href="../articles/b_time_dependency.html">Time-varying values</a>
    <a class="dropdown-item" href="../articles/c_homogeneous.html">Simple Markov Models (Homogeneous)</a>
    <a class="dropdown-item" href="../articles/d_non_homogeneous.html">Time-varying Markov Models (Non-Homogeneous)</a>
    <a class="dropdown-item" href="../articles/e_probabilistic.html">Probabilistic Uncertainty Analysis</a>
    <a class="dropdown-item" href="../articles/f_sensitivity.html">Deterministic Sensitivity Analysis</a>
    <a class="dropdown-item" href="../articles/g_heterogeneity.html">Heterogeneity &amp; Demographic Analysis</a>
    <a class="dropdown-item" href="../articles/h_tabular.html">Tabular Input</a>
    <a class="dropdown-item" href="../articles/i_reproduction.html">Reproducing Exact Results from DMHEE</a>
    <a class="dropdown-item" href="../articles/j_survival.html">Survival models</a>
    <a class="dropdown-item" href="../articles/j_survival_2_psa.html">Survival Models Part 2 - PSA</a>
    <a class="dropdown-item" href="../articles/k_calibration.html">Calibrating `heemod` models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/aphp/heemod/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Probabilistic Uncertainty Analysis</h1>
            
            <h4 data-toc-skip class="date">2024-02-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aphp/heemod/blob/HEAD/vignettes/e_probabilistic.Rmd" class="external-link"><code>vignettes/e_probabilistic.Rmd</code></a></small>
      <div class="d-none name"><code>e_probabilistic.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to transform the deterministic Markov model
presented in <code>vignette("c-homogeneous", "heemod")</code> in a
probabilistic model.</p>
<div class="section level2">
<h2 id="model-definition">Model definition<a class="anchor" aria-label="anchor" href="#model-definition"></a>
</h2>
<p>We will start by re-specifying the deterministic model of HIV therapy
described previously (a monotherapy strategy <code>mono</code> and
combined therapy strategy <code>comb</code>).</p>
<p>But instead of defining transition probabilities and state values
directly in <code><a href="../reference/define_transition.html">define_transition()</a></code> or
<code><a href="../reference/define_state.html">define_state()</a></code> (as in the previous vignette), parameters
will be defined first in a <code><a href="../reference/define_parameters.html">define_parameters()</a></code> step. This
is because only parameters defined this way can be resampled in a
probabilistic analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_parameters.html">define_parameters</a></span><span class="op">(</span></span>
<span>  rr <span class="op">=</span> <span class="fl">.509</span>,</span>
<span>  </span>
<span>  p_AA_mono <span class="op">=</span> <span class="fl">.721</span>,</span>
<span>  p_AB_mono <span class="op">=</span> <span class="fl">.202</span>,</span>
<span>  p_AC_mono <span class="op">=</span> <span class="fl">.067</span>,</span>
<span>  p_AD_mono <span class="op">=</span> <span class="fl">.010</span>,</span>
<span>  </span>
<span>  p_BC_mono <span class="op">=</span> <span class="fl">.407</span>,</span>
<span>  p_BD_mono <span class="op">=</span> <span class="fl">.012</span>,</span>
<span>  </span>
<span>  p_CD_mono <span class="op">=</span> <span class="fl">.250</span>,</span>
<span>  </span>
<span>  </span>
<span>  p_AB_comb <span class="op">=</span> <span class="va">p_AB_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  p_AC_comb <span class="op">=</span> <span class="va">p_AC_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  p_AD_comb <span class="op">=</span> <span class="va">p_AD_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  </span>
<span>  p_BC_comb <span class="op">=</span> <span class="va">p_BC_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  p_BD_comb <span class="op">=</span> <span class="va">p_BD_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  </span>
<span>  p_CD_comb <span class="op">=</span> <span class="va">p_CD_mono</span> <span class="op">*</span> <span class="va">rr</span>,</span>
<span>  </span>
<span>  p_AA_comb <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">p_AB_comb</span> <span class="op">+</span> <span class="va">p_AC_comb</span> <span class="op">+</span> <span class="va">p_AD_comb</span><span class="op">)</span>,</span>
<span>  </span>
<span>  </span>
<span>  cost_zido <span class="op">=</span> <span class="fl">2278</span>,</span>
<span>  cost_lami <span class="op">=</span> <span class="fl">2086</span>,</span>
<span>  </span>
<span>  cost_A <span class="op">=</span> <span class="fl">2756</span>,</span>
<span>  cost_B <span class="op">=</span> <span class="fl">3052</span>,</span>
<span>  cost_C <span class="op">=</span> <span class="fl">9007</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We need to define <code>p_AA_mono</code> and <code>p_AA_comb</code>
in <code><a href="../reference/define_parameters.html">define_parameters()</a></code> because we will need to resample
that value. Only values defined with <code><a href="../reference/define_parameters.html">define_parameters()</a></code>
can be resampled. So we cannot use the complement alias <code>C</code>
to specify <code>p_AA_comb</code> in <code><a href="../reference/define_transition.html">define_transition()</a></code>,
as we did before.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat_trans_mono</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_transition.html">define_transition</a></span><span class="op">(</span></span>
<span>  <span class="va">p_AA_mono</span>, <span class="va">p_AB_mono</span>, <span class="va">p_AC_mono</span>, <span class="va">p_AD_mono</span>,</span>
<span>  <span class="fl">0</span>,         <span class="va">C</span>,         <span class="va">p_BC_mono</span>, <span class="va">p_BD_mono</span>,</span>
<span>  <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="va">C</span>,         <span class="va">p_CD_mono</span>,</span>
<span>  <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No named state -&gt; generating names.</span></span>
<span><span class="va">mat_trans_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_transition.html">define_transition</a></span><span class="op">(</span></span>
<span>  <span class="va">p_AA_comb</span>, <span class="va">p_AB_comb</span>, <span class="va">p_AC_comb</span>, <span class="va">p_AD_comb</span>,</span>
<span>  <span class="fl">0</span>,         <span class="va">C</span>,         <span class="va">p_BC_comb</span>, <span class="va">p_BD_comb</span>,</span>
<span>  <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="va">C</span>,         <span class="va">p_CD_comb</span>,</span>
<span>  <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="fl">0</span>,         <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No named state -&gt; generating names.</span></span></code></pre></div>
<p>State definition remains the same in this example.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">state_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    cost_health <span class="op">=</span> <span class="fl">2756</span>,</span>
<span>    cost_drugs <span class="op">=</span> <span class="fu"><a href="../reference/dispatch_strategy.html">dispatch_strategy</a></span><span class="op">(</span></span>
<span>      mono <span class="op">=</span> <span class="va">cost_zido</span>,</span>
<span>      comb <span class="op">=</span> <span class="va">cost_zido</span> <span class="op">+</span> <span class="va">cost_lami</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cost_total <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">cost_health</span> <span class="op">+</span> <span class="va">cost_drugs</span>, <span class="fl">.06</span><span class="op">)</span>,</span>
<span>    life_year <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">state_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    cost_health <span class="op">=</span> <span class="fl">3052</span>,</span>
<span>    cost_drugs <span class="op">=</span> <span class="fu"><a href="../reference/dispatch_strategy.html">dispatch_strategy</a></span><span class="op">(</span></span>
<span>      mono <span class="op">=</span> <span class="va">cost_zido</span>,</span>
<span>      comb <span class="op">=</span> <span class="va">cost_zido</span> <span class="op">+</span> <span class="va">cost_lami</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cost_total <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">cost_health</span> <span class="op">+</span> <span class="va">cost_drugs</span>, <span class="fl">.06</span><span class="op">)</span>,</span>
<span>    life_year <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">state_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    cost_health <span class="op">=</span> <span class="fl">9007</span>,</span>
<span>    cost_drugs <span class="op">=</span> <span class="fu"><a href="../reference/dispatch_strategy.html">dispatch_strategy</a></span><span class="op">(</span></span>
<span>      mono <span class="op">=</span> <span class="va">cost_zido</span>,</span>
<span>      comb <span class="op">=</span> <span class="va">cost_zido</span> <span class="op">+</span> <span class="va">cost_lami</span></span>
<span>    <span class="op">)</span>,</span>
<span>    cost_total <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">cost_health</span> <span class="op">+</span> <span class="va">cost_drugs</span>, <span class="fl">.06</span><span class="op">)</span>,</span>
<span>    life_year <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">state_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    cost_health <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost_drugs <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost_total <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">cost_health</span> <span class="op">+</span> <span class="va">cost_drugs</span>, <span class="fl">.06</span><span class="op">)</span>,</span>
<span>    life_year <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Strategies must be first defined and run as in a standard
deterministic analysis.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_mono</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_strategy.html">define_strategy</a></span><span class="op">(</span></span>
<span>  transition <span class="op">=</span> <span class="va">mat_trans_mono</span>,</span>
<span>  <span class="va">state_A</span>,</span>
<span>  <span class="va">state_B</span>,</span>
<span>  <span class="va">state_C</span>,</span>
<span>  <span class="va">state_D</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No named state -&gt; generating names.</span></span>
<span></span>
<span><span class="va">strat_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_strategy.html">define_strategy</a></span><span class="op">(</span></span>
<span>  transition <span class="op">=</span> <span class="va">mat_trans_comb</span>,</span>
<span>  <span class="va">state_A</span>,</span>
<span>  <span class="va">state_B</span>,</span>
<span>  <span class="va">state_C</span>,</span>
<span>  <span class="va">state_D</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No named state -&gt; generating names.</span></span>
<span></span>
<span><span class="va">res_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span></span>
<span>  mono <span class="op">=</span> <span class="va">strat_mono</span>,</span>
<span>  comb <span class="op">=</span> <span class="va">strat_comb</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">param</span>,</span>
<span>  cycles <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  cost <span class="op">=</span> <span class="va">cost_total</span>,</span>
<span>  effect <span class="op">=</span> <span class="va">life_year</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="resampling-distributions">Resampling distributions<a class="anchor" aria-label="anchor" href="#resampling-distributions"></a>
</h2>
<p>Now we can define the resampling distributions. The following
parameters will be resampled:</p>
<ul>
<li>Relative risk.</li>
<li>Costs (such that cost are always positive).</li>
<li>Transition probability from AIDS to death.</li>
<li>The transition probabilities from state A.</li>
</ul>
<p>Since the log of a relative risk follows a lognormal distribution,
relative risk follows a lognormal distribution whose mean is
<code>rr</code> and standard deviation on the log scale can be deduced
from the relative risk confidence interval.</p>
<p><span class="math display">\[rr \sim lognormal(\mu = .509, \sigma =
.173)\]</span></p>
<p>Programmed as:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">lognormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.509</span>, sdlog <span class="op">=</span> <span class="fl">.173</span><span class="op">)</span></span></code></pre></div>
<p>Usually costs are resampled on a gamma distribution, which has the
property of being always positive. Shape and scale parameters of the
gamma distribution can be calculated from the mean and standard
deviation desired in the distribution. Here we assume that <em>mean =
variance</em>.</p>
<p><span class="math display">\[cost_A \sim \Gamma(\mu = 2756, \sigma =
\sqrt{2756})\]</span></p>
<p>This can be programmed as:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cost_A</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">gamma</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2756</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2756</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Proportions follow a binomial distribution that can be estimated by
giving the mean proportion and the size of the sample used to estimate
that proportion with
<code>p_CD ~ binomial(prob = .25, size = 40)</code>.</p>
<p>Finally multinomial distributions are declared with the number of
individuals in each group in the sample used to estimate the
proportions. These proportions follow a Dirichlet distribution:</p>
<ul>
<li><code>p_AA + p_AB + p_AC + p_AD ~ multinomial(721, 202, 67, 10)</code></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_psa.html">define_psa</a></span><span class="op">(</span></span>
<span>  <span class="va">rr</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">lognormal</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.509</span>, sdlog <span class="op">=</span> <span class="fl">.173</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">cost_A</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">gamma</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">2756</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2756</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">cost_B</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">gamma</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">3052</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3052</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">cost_C</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">gamma</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">9007</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">9007</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">p_CD_mono</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">binomial</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">.25</span>, size <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">p_AA_mono</span> <span class="op">+</span> <span class="va">p_AB_mono</span> <span class="op">+</span> <span class="va">p_AC_mono</span> <span class="op">+</span> <span class="va">p_AD_mono</span> <span class="op">~</span> <span class="fu"><a href="../reference/distributions.html">multinomial</a></span><span class="op">(</span><span class="fl">721</span>, <span class="fl">202</span>, <span class="fl">67</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-probabilistic-model">Run probabilistic model<a class="anchor" aria-label="anchor" href="#run-probabilistic-model"></a>
</h2>
<p>Now that the distributions of parameters are set we can simply run
the probabilistic model as follow:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_psa.html">run_psa</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">res_mod</span>,</span>
<span>  psa <span class="op">=</span> <span class="va">rsp</span>,</span>
<span>  N <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Resampling strategy 'mono'...</span></span>
<span><span class="co">#&gt; Resampling strategy 'mono'...</span></span>
<span><span class="co">#&gt; Resampling strategy 'comb'...</span></span>
<span><span class="co">#&gt; Resampling strategy 'comb'...</span></span></code></pre></div>
<p>The average results are computed. In theory these values are more
accurate than simple estimates because of non-linearities. An optional
<code>threshold</code> can be passed to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to
compute net monetary benefit.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span></span>
<span>  <span class="va">pm</span>, </span>
<span>  threshold <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">5000</span>, <span class="fl">6000</span>, <span class="fl">1e4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2 strategies run for 50 cycles.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Initial state counts:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A = 1000L</span></span>
<span><span class="co">#&gt; B = 0L</span></span>
<span><span class="co">#&gt; C = 0L</span></span>
<span><span class="co">#&gt; D = 0L</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Counting method: 'life-table'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Counting method: 'beginning'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Counting method: 'end'.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Values:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      cost_health cost_drugs cost_total life_year</span></span>
<span><span class="co">#&gt; comb   100030105   79208199   94681703 18150.366</span></span>
<span><span class="co">#&gt; mono    49606577   19988723   49559158  8774.681</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Net monetary benefit difference:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;          1000     5000     6000    10000</span></span>
<span><span class="co">#&gt; mono 35746.86    0.000     0.00     0.00</span></span>
<span><span class="co">#&gt; comb     0.00 1755.883 11131.57 48634.31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Efficiency frontier:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; mono -&gt; comb</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Differences:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Cost Diff. Effect Diff.    ICER Ref.</span></span>
<span><span class="co">#&gt; comb   45122.55     9.375686 4812.72 mono</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="result-interpretation">Result interpretation<a class="anchor" aria-label="anchor" href="#result-interpretation"></a>
</h2>
<p>The results of the analysis can be plotted on the cost-effectiveness
plane. We can see there seem to be little uncertainty on the costs
compared to the uncertainty on the effects, resulting in an uncertainty
cloud that looks like a line.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"ce"</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>And as cost-effectiveness acceptability curves or EVPI:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"ac"</span>, max_wtp <span class="op">=</span> <span class="fl">10000</span>, log_scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"evpi"</span>, max_wtp <span class="op">=</span> <span class="fl">10000</span>, log_scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-11-2.png" width="576" style="display: block; margin: auto;"></p>
<p>A covariance analysis can be performed on strategy results:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"cov"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: mgcv</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Or on the difference between strategies:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"cov"</span>, diff <span class="op">=</span> <span class="cn">TRUE</span>, threshold <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in compute_prop_var(mgcv::gam(formula = form_cost, data = .data)):</span></span>
<span><span class="co">#&gt; Parameter excluded because of perfect collinearity: p_AD_mono.</span></span>
<span><span class="co">#&gt; Warning in compute_prop_var(mgcv::gam(formula = form_nmb, data = .data)): Only</span></span>
<span><span class="co">#&gt; 99% of variance explained, results may be inaccurate.</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-13-1.png" width="384" style="display: block; margin: auto;"></p>
<p>As usual plots can be modified with the standard <code>ggplot2</code>
syntax.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pm</span>, type <span class="op">=</span> <span class="st">"ce"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Life-years gained"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Additional cost"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Strategy"</span>,</span>
<span>    palette <span class="op">=</span> <span class="st">"Set1"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="parallel-computing">Parallel computing<a class="anchor" aria-label="anchor" href="#parallel-computing"></a>
</h2>
<p>Resampling can be significantly sped up by using parallel computing.
This can be done in the following way:</p>
<ul>
<li>Define a cluster with the <code><a href="../reference/cluster.html">use_cluster()</a></code> functions
(i.e. <code>use_cluster(4)</code> to use 4 cores).</li>
<li>Run the analysis as usual.</li>
<li>To stop using parallel computing use the
<code><a href="../reference/cluster.html">close_cluster()</a></code> function.</li>
</ul>
<p>Results may vary depending on the machine, but we found speed gains
to be quite limited beyond 4 cores.</p>
</div>
<div class="section level2">
<h2 id="interface-with-bcea-and-savi">Interface with BCEA and SAVI<a class="anchor" aria-label="anchor" href="#interface-with-bcea-and-savi"></a>
</h2>
<p>To compute EVPPI the results can also be exported with
<code><a href="../reference/export_savi.html">export_savi()</a></code> in a format compatible with the <a href="https://savi.shef.ac.uk/SAVI/" class="external-link">SAVI</a> software (Sheffield
Accelerated Value of Information).</p>
<p>The results can be post-processed by the <code>BCEA</code> package
with the <code><a href="../reference/run_bcea.html">run_bcea()</a></code> function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bcea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_bcea.html">run_bcea</a></span><span class="op">(</span><span class="va">pm</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, Kmax <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: BCEA</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'BCEA':</span></span>
<span><span class="co">#&gt;   method     from</span></span>
<span><span class="co">#&gt;   plot.evppi voi</span></span>
<span><span class="co">#&gt; No reference selected. Defaulting to first intervention.</span></span></code></pre></div>
<p><img src="e_probabilistic_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bcea</span><span class="op">)</span></span>
<span><span class="co">#&gt; NB: k (wtp) is defined in the interval [0 - 10000]</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost-effectiveness analysis summary </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Reference intervention:  comb</span></span>
<span><span class="co">#&gt; Comparator intervention: mono</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal decision: choose comb for k &lt; 4820 and mono for k &gt;= 4820</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Analysis for willingness to pay parameter k = 10000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Expected net benefit</span></span>
<span><span class="co">#&gt; comb             38187651</span></span>
<span><span class="co">#&gt; mono             86821962</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                    EIB CEAC   ICER</span></span>
<span><span class="co">#&gt; comb vs mono -48634311    0 4812.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Optimal intervention (max expected net benefit) for k = 10000: mono</span></span>
<span><span class="co">#&gt;                </span></span>
<span><span class="co">#&gt; EVPI 6.7046e-09</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Zarca, Antoine Filipovic-Pierucci.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
