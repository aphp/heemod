<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="heemod">
<title>Time-varying Markov Models (Non-Homogeneous) â€¢ heemod</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Time-varying Markov Models (Non-Homogeneous)">
<meta property="og:description" content="heemod">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">heemod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_introduction.html">An Introduction to `heemod`</a>
    <a class="dropdown-item" href="../articles/b_time_dependency.html">Time-varying values</a>
    <a class="dropdown-item" href="../articles/c_homogeneous.html">Simple Markov Models (Homogeneous)</a>
    <a class="dropdown-item" href="../articles/d_non_homogeneous.html">Time-varying Markov Models (Non-Homogeneous)</a>
    <a class="dropdown-item" href="../articles/e_probabilistic.html">Probabilistic Uncertainty Analysis</a>
    <a class="dropdown-item" href="../articles/f_sensitivity.html">Deterministic Sensitivity Analysis</a>
    <a class="dropdown-item" href="../articles/g_heterogeneity.html">Heterogeneity &amp; Demographic Analysis</a>
    <a class="dropdown-item" href="../articles/h_tabular.html">Tabular Input</a>
    <a class="dropdown-item" href="../articles/i_reproduction.html">Reproducing Exact Results from DMHEE</a>
    <a class="dropdown-item" href="../articles/j_survival.html">Survival models</a>
    <a class="dropdown-item" href="../articles/j_survival_2_psa.html">Survival Models Part 2 - PSA</a>
    <a class="dropdown-item" href="../articles/k_calibration.html">Calibrating `heemod` models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/aphp/heemod/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Time-varying Markov Models (Non-Homogeneous)</h1>
            
            <h4 data-toc-skip class="date">2024-02-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aphp/heemod/blob/HEAD/vignettes/d_non_homogeneous.Rmd" class="external-link"><code>vignettes/d_non_homogeneous.Rmd</code></a></small>
      <div class="d-none name"><code>d_non_homogeneous.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="model-description">Model description<a class="anchor" aria-label="anchor" href="#model-description"></a>
</h2>
<p>This example is an implementation of the assessment of a new total
hip replacement (THR) technology described in chapter 3.5 of <a href="https://global.oup.com/academic/product/decision-modelling-for-health-economic-evaluation-9780198526629" class="external-link">Decision
Modelling for Health Economic Evaluation</a>. A more detailed report is
available <a href="https://www.york.ac.uk/media/che/documents/papers/technicalpapers/CHE%20Technical%20Paper%2028.pdf" class="external-link">at
this location</a>. This reports goes a bit further in the analysis. For
the sake of simplicity we will not reproduce exactly the analysis from
the book. See vignette <code>vignette("i-reproduction", "heemod")</code>
for an exact reproduction.</p>
<p>This model has 5 states:</p>
<ul>
<li>Primary THR: starting state, individuals receive either the standard
or the new THR (called NP1), outcomes are either success of primary THR
or death (the operative mortality rate of primary THR will be called
<code>omrPTHR</code>);</li>
<li>Success of primary THR: state after receiving primary THR if the
surgery is successful, individuals can stay in that state, need a THR
revision, or die of other causes;</li>
<li>Revision of primary THR: for individuals whose primary THR needed
revision, outcomes are either success of revision THR or death (the
operative mortality rate of revision THR will be called
<code>omrRTHR</code>);</li>
<li>Success of revision THR: state after receiving revision THR if the
surgery is successful, individuals can stay in that state, need a THR
re-revision, or die of other causes;</li>
<li>Death (either caused by THR or another cause).</li>
</ul>
<p>Two transition probabilities are time-varying in this model:</p>
<ul>
<li>Probability of death by another cause increases with age;</li>
<li>Probability of primary THR revision changes with time.</li>
</ul>
</div>
<div class="section level2">
<h2 id="other-cause-death">Other-Cause death<a class="anchor" aria-label="anchor" href="#other-cause-death"></a>
</h2>
<p>Other-cause death probabilities (mortality rate <code>mr</code>) for
the United Kingdom is taken from WHO databases using the
<code><a href="../reference/who_mortality.html">get_who_mr()</a></code> function. The variable <code>sex</code>,
taking values <code>0</code> and <code>1</code>, must be recoded in
<code>"FMLE"</code> and <code>"MLE"</code> before being passed to this
function.</p>
</div>
<div class="section level2">
<h2 id="thr-revision">THR revision<a class="anchor" aria-label="anchor" href="#thr-revision"></a>
</h2>
<ul>
<li>Primary THR revision probability for the standard THR, called
<code>standardRR</code> increases with time with the following formula
(a <a href="https://en.wikipedia.org/wiki/Weibull_distribution" class="external-link">Weibull
distribution</a>):</li>
</ul>
<p><span class="math display">\[
P_{revision} = 1 - \exp(\lambda \times ((t-1)^\gamma-t^\gamma))
\]</span></p>
<p>Where <span class="math inline">\(t\)</span> is the time since
revision, <span class="math inline">\(\gamma = 1.45367786\)</span>
and:</p>
<p><span class="math display">\[
\lambda = exp(cons + ageC \times age + maleC \times sex)
\]</span></p>
<p>Where <span class="math inline">\(age\)</span> and <span class="math inline">\(sex\)</span> (female = <em>0</em>, male =
<em>1</em>) are individual characteristics, <span class="math inline">\(cons = -5.49094\)</span>, <span class="math inline">\(ageC = -0.0367\)</span> and <span class="math inline">\(maleC = 0.768536\)</span>.</p>
<ul>
<li>For the NP1 procedure the standard procedure revision probability
<code>standardRR</code> is modified by the relative risk <span class="math inline">\(rrNP1 = 0.260677\)</span>.</li>
</ul>
<p><span class="math display">\[
P_{revision} = 1 - \exp(\lambda \times rr \times NP1 \times
((t-1)^\gamma-t^\gamma))
\]</span></p>
<ul>
<li>Revision THR re-revision (<code>rrr</code>) probability is set to be
constant at <em>0.04</em> per year.</li>
</ul>
</div>
<div class="section level2">
<h2 id="parameter-definition">Parameter definition<a class="anchor" aria-label="anchor" href="#parameter-definition"></a>
</h2>
<p>The key element to specify time-varying elements in
<code>heemod</code> is through the use of the <strong>package-defined
variables</strong> <code>model_time</code> and <code>state_time</code>.
See vignette <code>vignette("b-time-dependency", "heemod")</code> for
more details.</p>
<p>In order to build this more complex Markov model, parameters need to
be defined through <code><a href="../reference/define_parameters.html">define_parameters()</a></code> (for 2 reasons: to
keep the transition matrix readable, and to avoid repetition by re-using
parameters between strategies).</p>
<p>The equations decribed in the previous section can be written easily,
here for a female population (<code>sex</code> = <em>0</em>) starting at
60 years old (<code>age_init</code> = <em>60</em>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">param</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_parameters.html">define_parameters</a></span><span class="op">(</span></span>
<span>    age_init <span class="op">=</span> <span class="fl">60</span>,</span>
<span>    sex <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    </span>
<span>    <span class="co"># age increases with cycles</span></span>
<span>    age <span class="op">=</span> <span class="va">age_init</span> <span class="op">+</span> <span class="va">model_time</span>,</span>
<span>    </span>
<span>    <span class="co"># operative mortality rates</span></span>
<span>    omrPTHR <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>    omrRTHR <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>    </span>
<span>    <span class="co"># re-revision mortality rate</span></span>
<span>    rrr <span class="op">=</span> <span class="fl">.04</span>,</span>
<span>    </span>
<span>    <span class="co"># parameters for calculating primary revision rate</span></span>
<span>    cons <span class="op">=</span> <span class="op">-</span><span class="fl">5.49094</span>,</span>
<span>    ageC <span class="op">=</span> <span class="op">-</span><span class="fl">.0367</span>,</span>
<span>    maleC <span class="op">=</span> <span class="fl">.768536</span>,</span>
<span>    lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">cons</span> <span class="op">+</span> <span class="va">ageC</span> <span class="op">*</span> <span class="va">age_init</span> <span class="op">+</span> <span class="va">maleC</span> <span class="op">*</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>    gamma <span class="op">=</span> <span class="fl">1.45367786</span>,</span>
<span>    </span>
<span>    rrNP1 <span class="op">=</span> <span class="fl">.260677</span>,</span>
<span>    </span>
<span>    <span class="co"># revision probability of primary procedure</span></span>
<span>    standardRR <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">model_time</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">^</span> <span class="va">gamma</span> <span class="op">-</span></span>
<span>                                     <span class="va">model_time</span> <span class="op">^</span> <span class="va">gamma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    np1RR <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">lambda</span> <span class="op">*</span> <span class="va">rrNP1</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">model_time</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">^</span> <span class="va">gamma</span> <span class="op">-</span> </span>
<span>                                        <span class="va">model_time</span> <span class="op">^</span> <span class="va">gamma</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># age-related mortality rate</span></span>
<span>    sex_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="fl">0</span>, <span class="st">"FMLE"</span>, <span class="st">"MLE"</span><span class="op">)</span>,</span>
<span>    mr <span class="op">=</span> <span class="fu"><a href="../reference/who_mortality.html">get_who_mr</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex_cat</span>, local <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># state values</span></span>
<span>    u_SuccessP <span class="op">=</span> <span class="fl">.85</span>,</span>
<span>    u_RevisionTHR <span class="op">=</span> <span class="fl">.30</span>,</span>
<span>    u_SuccessR <span class="op">=</span> <span class="fl">.75</span>,</span>
<span>    c_RevisionTHR <span class="op">=</span> <span class="fl">5294</span></span>
<span><span class="op">)</span></span>
<span><span class="va">param</span></span></code></pre></div>
<pre><code><span><span class="co">## 20 unevaluated parameters.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## age_init = 60</span></span>
<span><span class="co">## sex = 0</span></span>
<span><span class="co">## age = age_init + model_time</span></span>
<span><span class="co">## omrPTHR = 0.02</span></span>
<span><span class="co">## omrRTHR = 0.02</span></span>
<span><span class="co">## rrr = 0.04</span></span>
<span><span class="co">## cons = -5.49094</span></span>
<span><span class="co">## ageC = -0.0367</span></span>
<span><span class="co">## maleC = 0.768536</span></span>
<span><span class="co">## lambda = exp(cons + ageC * age_init + maleC * sex)</span></span>
<span><span class="co">## gamma = 1.45367786</span></span>
<span><span class="co">## rrNP1 = 0.260677</span></span>
<span><span class="co">## standardRR = 1 - ...</span></span>
<span><span class="co">## np1RR = 1 - ...</span></span>
<span><span class="co">## sex_cat = ifelse(sex == 0, "FMLE", "MLE")</span></span>
<span><span class="co">## mr = get_who_mr(age, sex_cat, local = TRUE)</span></span>
<span><span class="co">## u_SuccessP = 0.85</span></span>
<span><span class="co">## u_RevisionTHR = 0.3</span></span>
<span><span class="co">## u_SuccessR = 0.75</span></span>
<span><span class="co">## c_RevisionTHR = 5294</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="transition-matrix-definition">Transition matrix definition<a class="anchor" aria-label="anchor" href="#transition-matrix-definition"></a>
</h2>
<p>Now that parameters are defined, the probability transitions can be
easily written:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_transition.html">define_transition</a></span><span class="op">(</span></span>
<span>    state_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"PrimaryTHR"</span>,</span>
<span>      <span class="st">"SuccessP"</span>,</span>
<span>      <span class="st">"RevisionTHR"</span>,</span>
<span>      <span class="st">"SuccessR"</span>,</span>
<span>      <span class="st">"Death"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fl">0</span>, <span class="va">C</span>, <span class="fl">0</span>,          <span class="fl">0</span>, <span class="va">omrPTHR</span>,</span>
<span>    <span class="fl">0</span>, <span class="va">C</span>, <span class="va">standardRR</span>, <span class="fl">0</span>, <span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,          <span class="va">C</span>, <span class="va">omrRTHR</span><span class="op">+</span><span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">rrr</span>,        <span class="va">C</span>, <span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,          <span class="fl">0</span>, <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mat_standard</span></span></code></pre></div>
<pre><code><span><span class="co">## A transition matrix, 5 states.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             PrimaryTHR SuccessP RevisionTHR SuccessR Death       </span></span>
<span><span class="co">## PrimaryTHR             C                             omrPTHR     </span></span>
<span><span class="co">## SuccessP               C        standardRR           mr          </span></span>
<span><span class="co">## RevisionTHR                                 C        omrRTHR + mr</span></span>
<span><span class="co">## SuccessR                        rrr         C        mr          </span></span>
<span><span class="co">## Death                                                1</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat_np1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_transition.html">define_transition</a></span><span class="op">(</span></span>
<span>    state_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"PrimaryTHR"</span>,</span>
<span>      <span class="st">"SuccessP"</span>,</span>
<span>      <span class="st">"RevisionTHR"</span>,</span>
<span>      <span class="st">"SuccessR"</span>,</span>
<span>      <span class="st">"Death"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fl">0</span>, <span class="va">C</span>, <span class="fl">0</span>,          <span class="fl">0</span>, <span class="va">omrPTHR</span>,</span>
<span>    <span class="fl">0</span>, <span class="va">C</span>, <span class="va">np1RR</span>,      <span class="fl">0</span>, <span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,          <span class="va">C</span>, <span class="va">omrRTHR</span><span class="op">+</span><span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">rrr</span>,        <span class="va">C</span>, <span class="va">mr</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,          <span class="fl">0</span>, <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mat_np1</span></span></code></pre></div>
<pre><code><span><span class="co">## A transition matrix, 5 states.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             PrimaryTHR SuccessP RevisionTHR SuccessR Death       </span></span>
<span><span class="co">## PrimaryTHR             C                             omrPTHR     </span></span>
<span><span class="co">## SuccessP               C        np1RR                mr          </span></span>
<span><span class="co">## RevisionTHR                                 C        omrRTHR + mr</span></span>
<span><span class="co">## SuccessR                        rrr         C        mr          </span></span>
<span><span class="co">## Death                                                1</span></span></code></pre>
<p>While it is possible to plot the matrix thanks to the
<code>diagram</code> package, the results may not always be easy to
read.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mat_standard</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: diagram</span></span></code></pre>
<p><img src="d_non_homogeneous_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="state-strategy-definition">State &amp; strategy definition<a class="anchor" aria-label="anchor" href="#state-strategy-definition"></a>
</h2>
<p>Utilities and costs are then associated to states. In this model
costs are discounted at a rate of 6% and utilities at a rate of
1.5%.</p>
<p>Now that parameters, transition matrix and states are defined we can
define the strategies for the control group and the NP1 treatment.</p>
<p>We use <code><a href="../reference/define_starting_values.html">define_starting_values()</a></code> to take into account the
cost of surgery.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_standard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_strategy.html">define_strategy</a></span><span class="op">(</span></span>
<span>  transition <span class="op">=</span> <span class="va">mat_standard</span>,</span>
<span>  PrimaryTHR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  SuccessP <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_SuccessP</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  RevisionTHR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_RevisionTHR</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">c_RevisionTHR</span>, <span class="fl">.06</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  SuccessR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_SuccessR</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Death <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  starting_values <span class="op">=</span> <span class="fu"><a href="../reference/define_starting_values.html">define_starting_values</a></span><span class="op">(</span></span>
<span>    cost <span class="op">=</span> <span class="fl">394</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">strat_standard</span></span></code></pre></div>
<pre><code><span><span class="co">## A Markov model strategy:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     5 states,</span></span>
<span><span class="co">##     2 state values</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strat_np1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_strategy.html">define_strategy</a></span><span class="op">(</span></span>
<span>  transition <span class="op">=</span> <span class="va">mat_np1</span>,</span>
<span>  PrimaryTHR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  SuccessP <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_SuccessP</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  RevisionTHR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_RevisionTHR</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">c_RevisionTHR</span>, <span class="fl">.06</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  SuccessR <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fu"><a href="../reference/discount.html">discount</a></span><span class="op">(</span><span class="va">u_SuccessR</span>, <span class="fl">.015</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Death <span class="op">=</span> <span class="fu"><a href="../reference/define_state.html">define_state</a></span><span class="op">(</span></span>
<span>    utility <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    cost <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  starting_values <span class="op">=</span> <span class="fu"><a href="../reference/define_starting_values.html">define_starting_values</a></span><span class="op">(</span></span>
<span>    cost <span class="op">=</span> <span class="fl">579</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">strat_np1</span></span></code></pre></div>
<pre><code><span><span class="co">## A Markov model strategy:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     5 states,</span></span>
<span><span class="co">##     2 state values</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-analysis">Model analysis<a class="anchor" aria-label="anchor" href="#model-analysis"></a>
</h2>
<p>Both strategies can now be run for 60 years. By default models are
computed for 1000 person starting in <code>PrimaryTHR</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span></span>
<span>  standard <span class="op">=</span> <span class="va">strat_standard</span>,</span>
<span>  np1      <span class="op">=</span> <span class="va">strat_np1</span>,</span>
<span>  parameters <span class="op">=</span> <span class="va">param</span>,</span>
<span>  cycles <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  cost <span class="op">=</span> <span class="va">cost</span>,</span>
<span>  effect <span class="op">=</span> <span class="va">utility</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Fetching mortality data from package cached data.</span></span></code></pre>
<pre><code><span><span class="co">## Using cached data from year 2019.</span></span></code></pre>
<p>A comparison of both strategies can be done with
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>. The incremental cost and effect are displayed in
columns <code>Cost</code> and <code>Effect</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 2 strategies run for 60 cycles.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initial state counts:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## PrimaryTHR = 1000L</span></span>
<span><span class="co">## SuccessP = 0L</span></span>
<span><span class="co">## RevisionTHR = 0L</span></span>
<span><span class="co">## SuccessR = 0L</span></span>
<span><span class="co">## Death = 0L</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Counting method: 'life-table'.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Counting method: 'beginning'.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Counting method: 'end'.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Values:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           utility     cost</span></span>
<span><span class="co">## standard 16949.57 535002.2</span></span>
<span><span class="co">## np1      17009.10 616348.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Efficiency frontier:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## standard -&gt; np1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Differences:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Cost Diff. Effect Diff.     ICER     Ref.</span></span>
<span><span class="co">## np1    81.3463   0.05953445 1366.374 standard</span></span></code></pre>
<p>The new treatment costs Â£1366 more per QALY gained.</p>
<p>It should be noted that this result differs from the original study.
This difference is explained by higher population-level all-causes
mortality rates in the original study than in the WHO database (used
here). See vignette <code>vignette("i-reproduction", "heemod")</code>
for an exact reproduction of the analysis.</p>
<p>We can plot the counts per state:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res_mod</span>, type <span class="op">=</span> <span class="st">"counts"</span>, panel <span class="op">=</span> <span class="st">"by_state"</span>, free_y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Strategy"</span>,</span>
<span>    palette <span class="op">=</span> <span class="st">"Set1"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Scale for <span style="color: #00BB00;">colour</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">colour</span>, which will replace the existing scale.</span></span></code></pre>
<p><img src="d_non_homogeneous_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kevin Zarca, Antoine Filipovic-Pierucci.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
